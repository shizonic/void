#!/usr/bin/env sh

cpu=$(grep 'model name' /proc/cpuinfo | head -n 1 | awk -F ':' '{print $2}' | xargs)
cpu_num=$(grep 'model name' /proc/cpuinfo | wc -l)
cpu_brand=$(printf "${cpu}" | cut -d ' ' -f 1 | cut -d '(' -f 1 | xargs)
cpu_freq=$(printf "${cpu}" | cut -d '@' -f 2 | xargs)
#cpu='Intel i7-7500U CPU @ 2.70GHz'
#gpu=$(lspci | grep 'Display' | awk -F '.' '{print $3}' | xargs)
gpu='AMD Radeon R7 M445'
#ram=$(free -m | awk 'NR==2{printf "%s/%sMB (%.2f%%)\n", $3,$2,$3*100/$2 }')
ram=$(free -m | awk 'NR==2{printf "%s/%s\n", $3,$2 }')
rom=$(df -h /data | tail -n 1 | cut -d ' ' -f 3 | tr -d 'G')
os=$(. /etc/os-release; echo "${NAME}")
knl="$(uname -r) ($(uname -m))"
#stp=$(basename $(realpath ~/app/dat/x/stp/current))
#thm=$(basename $(realpath ~/app/dat/x/thm/current))
stp="${STP_NAME}"
thm="${THM_NAME}"
pkg=$(xbps-query -l | wc -l)

if test "$#" -ne 0; then
  ip=$(curl -s "https://api.ipify.org")
  test -z "${ip}" && exit 1

  loc=$(curl -s "freegeoip.net/csv/${ip}")
  test -z "${loc}" && exit 1
 
  lng=$(echo "${loc}" | awk -F ',' '{print $9}')
  lat=$(echo "${loc}" | awk -F ',' '{print $10}')
fi

printf "  ┌────────────────────────
  │ \033[0;33m$os\033[0m $knl
  └── sys ────────────────┐
    \033[0;33mram\033[0m: ${ram} MB
    \033[0;33mrom\033[0m: ${rom} GB
    \033[0;33mcpu\033[0m: ${cpu_brand} ${cpu_freq} x${cpu_num}
    \033[0;33mgpu\033[0m: ${gpu}
    \033[0;33mpkg\033[0m: ${pkg}
  ┌── usr ────────────────┘
    \033[0;33mstp\033[0m: ${stp}
    \033[0;33mthm\033[0m: ${thm}"
#  └───────────────────────"

printf '\n  └── rom ────────────────┐\n'
for blkDev in /boot /data; do
  blkDat=$(df -h "${blkDev}" | tail -n 1 | awk -F ' ' '{print $3"/"$2" ("$5")"}')
  printf '    \033[0;33m%s\033[0m: %s\n' $(basename "${blkDev}") "${blkDat}"
done


printf '\n  └── lvm ────────────────┐\n'
for lvmDev in /dev/lvm/*; do
  lvmDat=$(df -h "${lvmDev}" | tail -n 1 | awk -F ' ' '{print $3"/"$2" ("$5")"}')
  printf '    \033[0;33m%s\033[0m: %s\n' $(basename "${lvmDev}") "${lvmDat}"
done

if test "$#" -ne 0; then
  printf "┐
  ┌── prv ────────────────┘
    \033[0;33mloc\033[0m: ${lng} | ${lat}
    \033[0;33mip \033[0m: ${ip}
  └───────────────────────"
fi

printf '\n'
